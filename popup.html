<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SankeyStone</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- Main Sankey View -->
        <div id="main-view" class="view">
            <header>
                <div class="header-content">
                    <h1>SankeyStone</h1>
                    <p>Generate Sankey Diagrams</p>
                </div>
                <button id="setup-btn" class="setup-btn" title="Configure LLM API Keys">⚙️</button>
            </header>
            
            <main>
                <!-- Status Message at Top -->
                <div id="diagram-status" class="diagram-status hidden">
                    <span id="status-icon">📊</span>
                    <span id="status-text">Sample data generated by extension</span>
                </div>
                
                <div id="sankey-container">
                    <div id="loading">Initializing...</div>
                    <svg id="sankey-svg"></svg>
                </div>
                
                <div class="controls">
                    <select id="color-dropdown">
                        <option value="0">Classic</option>
                        <option value="1">Ocean Depths</option>
                        <option value="2">Sunset Gradient</option>
                        <option value="3">Forest Canopy</option>
                        <option value="4">Vibrant</option>
                        <option value="5">Coral Reef</option>
                        <option value="6">Neon Nights</option>
                        <option value="7">Soft Pastels</option>
                        <option value="8">Cosmic Aurora</option>
                        <option value="9">Tropical Paradise</option>
                        <option value="10">Cyberpunk City</option>
                        <option value="11">Cherry Blossom</option>
                        <option value="12">Retro Wave</option>
                        <option value="13">Mint Fresh</option>
                        <option value="14">Golden Hour</option>
                    </select>
                    <button id="refresh-btn">🔄 Refresh from Page</button>
                    <button id="random-btn">🎲 Random</button>
                    <button id="download-btn">💾 Download PNG</button>
                </div>
                
                <!-- Debug Section -->
                <div id="debug-section" class="debug-section">
                    <div class="debug-header">
                        <button id="debug-toggle" class="debug-toggle">🔍 LLM Debug Logs</button>
                        <button id="debug-clear" class="debug-clear" title="Clear debug logs">🗑️</button>
                    </div>
                    <div id="debug-content" class="debug-content hidden">
                        <textarea id="debug-output" class="debug-output" readonly placeholder="LLM API call logs will appear here..."></textarea>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Setup View -->
        <div id="setup-view" class="view hidden">
            <header>
                <div class="header-content">
                    <button id="back-btn" class="back-btn" title="Back to Main">←</button>
                    <h1>⚙️ Setup</h1>
                </div>
            </header>
            
            <main class="setup-main">
                <div id="status-message" class="status-message hidden"></div>
                <form id="setup-form" class="setup-form">
                    <div class="section">
                        <h2>🤖 LLM API Configuration</h2>
                        <p class="section-description">Configure your preferred LLM providers. API keys are stored locally and securely.</p>
                        
                        <div class="form-group">
                            <label for="anthropic-key">
                                <span class="provider-icon">🎭</span>
                                Anthropic API Key
                                <span class="optional">(Claude)</span>
                            </label>
                            <div class="input-wrapper">
                                <input type="password" id="anthropic-key" name="anthropic-key" placeholder="sk-ant-...">
                            </div>
                            <div class="input-actions">
                                <button type="button" class="toggle-visibility" data-target="anthropic-key">👁️ Show</button>
                                <button type="button" class="test-key-btn" data-provider="anthropic" title="Test API Key">🧪 Test Key</button>
                            </div>
                            <small class="help-text">Get your API key from <a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a></small>
                        </div>

                        <div class="form-group future-support">
                            <div class="future-notice">
                                <span class="future-icon">🚀</span>
                                <div class="future-content">
                                    <strong>Coming Soon</strong>
                                    <p>Support for additional LLM providers (OpenAI, Google AI, and others) will be added in future releases.</p>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="section">
                        <h2>🎯 Default Settings</h2>
                        <p class="section-description">Choose your preferred default LLM provider and other settings.</p>
                        
                        <div class="form-group">
                            <label for="default-provider">Default LLM Provider</label>
                            <select id="default-provider" name="default-provider">
                                <option value="">Select a provider...</option>
                                <option value="anthropic">Anthropic (Claude)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="auto-analyze">
                                <input type="checkbox" id="auto-analyze" name="auto-analyze">
                                Auto-analyze Sankey diagrams with LLM
                            </label>
                            <small class="help-text">Automatically generate insights and analysis when creating diagrams</small>
                        </div>
                    </div>

                    <div class="section">
                        <h2>🔒 Privacy & Security</h2>
                        <div class="privacy-info">
                            <p>🛡️ <strong>Your API keys are stored locally</strong> in your browser using Chrome's secure storage API.</p>
                            <p>🚫 <strong>Keys are never transmitted</strong> to our servers or any third parties.</p>
                            <p>🔐 <strong>Keys are encrypted</strong> and only accessible by this extension.</p>
                            <p>🗑️ You can clear all stored data at any time using the button below.</p>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="clear-data-btn" class="btn btn-danger">🗑️ Clear All Data</button>
                        <div class="primary-actions">
                            <button type="button" id="cancel-btn" class="btn btn-secondary">Cancel</button>
                            <button type="submit" id="save-btn" class="btn btn-primary">💾 Save Settings</button>
                        </div>
                    </div>
                </form>
            </main>
        </div>
    </div>
    
<script src="popup.js"></script>
<script src="llm.js"></script>
</body>
</html>
